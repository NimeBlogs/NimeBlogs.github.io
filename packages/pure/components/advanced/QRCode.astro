---
import type { UserConfig } from '../../types/user-config'
import rawConfig from 'virtual:config'

const config = rawConfig as UserConfig

interface Props {
  content?: string
  class?: string
}

const { content, class: className, ...props } = Astro.props as Props
---

<div id='qrcode-container' class={className} {...props}></div>

<script is:inline src={`${config.npmCDN}/qrcodejs/qrcode.min.js`}></script>
<script is:inline define:vars={{ content }}>
  const renderContent = content ?? window.location.href
  // Load qrcode
  function loadQRcode(qrcodeContainer) {
    if (!qrcodeContainer) throw new Error('qrcode container not found')
    if (qrcodeContainer.innerHTML !== '') return
    new QRCode(qrcodeContainer, renderContent)
  }
  const qrcodeContainer = document.getElementById('qrcode-container')
  if (!qrcodeContainer) throw new Error('qrcode container not found')
  loadQRcode(qrcodeContainer)
</script>
